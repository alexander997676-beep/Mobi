<!-- BOOT SCREEN (Start Wala Hissa Updated) -->
<div id="boot-layer">
    <!-- Text Updated Here -->
    <div class="matrix-text">FAZ INFO v9.0</div>
    <div class="loader-bar"><div class="loader-fill"></div></div>
</div>

<!-- SIDEBAR SETTINGS -->
<aside class="sidebar">
    <div class="logo-icon"><i class="fa-solid fa-atom"></i></div>
    <div class="theme-dot cyan" onclick="setTheme('cyan')" title="Cyan Theme"></div>
    <div class="theme-dot purple" onclick="setTheme('purple')" title="Purple Theme"></div>
    <div class="theme-dot green" onclick="setTheme('green')" title="Green Theme"></div>
    <div class="theme-dot gold" onclick="setTheme('gold')" title="Gold Theme"></div>
</aside>

<!-- MAIN AREA -->
<main class="main-viewport">
    <div class="header-section">
        <!-- Header Updated Here -->
        <h1>FAZ <span style="color:var(--primary)">INFO</span></h1>
        <div class="subtitle">Next-Gen Specification Database</div>
    </div>

    <div class="search-container">
        <input type="text" id="inp" class="search-input" placeholder="Initialize Search Protocol...">
        <button class="search-btn" onclick="runSearch()"><i class="fa-solid fa-search"></i></button>
    </div>

    <div class="results-grid" id="grid"></div>
</main>

<!-- DOCK HISTORY -->
<div class="dock" id="dock" style="display:none">
    <div class="dock-label">RECENT</div>
    <div id="dock-content" style="display:flex; gap:10px;"></div>
</div>

<!-- HOLOGRAPHIC MODAL -->
<div class="holo-overlay" id="modal">
    <div class="holo-interface">
        <div class="close-holo" onclick="closeModal()">&times;</div>
        <div class="holo-col-left">
            <img id="m-img" src="" alt="">
        </div>
        <div class="holo-col-right">
            <h2 id="m-title" class="holo-title"></h2>
            
            <!-- VISUAL METERS -->
            <div class="meter-container">
                <!-- RAM METER -->
                <div class="meter-box">
                    <div class="circle-chart">
                        <svg width="80" height="80">
                            <circle class="circle-bg" cx="40" cy="40" r="35"></circle>
                            <circle class="circle-fill" id="meter-ram" cx="40" cy="40" r="35"></circle>
                        </svg>
                        <div class="circle-text" id="txt-ram">0GB</div>
                    </div>
                    <div class="meter-label">Memory</div>
                </div>
                <!-- BATTERY METER -->
                <div class="meter-box">
                    <div class="circle-chart">
                        <svg width="80" height="80">
                            <circle class="circle-bg" cx="40" cy="40" r="35"></circle>
                            <circle class="circle-fill" id="meter-bat" cx="40" cy="40" r="35"></circle>
                        </svg>
                        <div class="circle-text" id="txt-bat">0mAh</div>
                    </div>
                    <div class="meter-label">Energy</div>
                </div>
            </div>

            <p id="m-desc" class="holo-desc"></p>

            <div class="holo-actions">
                <button class="holo-btn" onclick="speakDetails()">
                    <i class="fa-solid fa-volume-high"></i> SPEAK
                </button>
                <a id="btn-dl" href="#" target="_blank" class="holo-btn">
                    <i class="fa-solid fa-download"></i> IMAGE
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // CONFIG
    const API_URL = "https://api.xyro.site/search/gsmarena?query=";
    const grid = document.getElementById('grid');
    const input = document.getElementById('inp');
    const modal = document.getElementById('modal');
    const dock = document.getElementById('dock');
    const dockContent = document.getElementById('dock-content');
    
    let historyList = [];
    let currentTextToSpeak = "";

    // INIT
    window.onload = () => {
        setTimeout(() => { document.getElementById('boot-layer').style.display = 'none'; }, 1600);
        input.focus();
    };

    // THEME SWITCHER
    function setTheme(color) {
        document.documentElement.setAttribute('data-theme', color);
    }

    // SEARCH
    input.addEventListener('keypress', (e) => { if(e.key === 'Enter') runSearch(); });

    async function runSearch(term = null) {
        const query = term || input.value.trim();
        if(!query) return;
        input.value = query;

        grid.innerHTML = `<h3 style="color:var(--primary); margin-top:20px;">SCANNING...</h3>`;

        try {
            const res = await fetch(API_URL + encodeURIComponent(query));
            const json = await res.json();
            
            grid.innerHTML = "";
            if(json.data && json.data.length > 0) {
                json.data.forEach(phone => {
                    const card = document.createElement('div');
                    card.className = 'data-card';
                    card.innerHTML = `
                        <div class="card-visual"><img src="${phone.thumbnail}" onerror="this.src='https://via.placeholder.com/200'"></div>
                        <div class="card-data">
                            <div class="card-title">${phone.name}</div>
                            <div class="card-meta">${phone.description}</div>
                        </div>
                    `;
                    card.onclick = () => openHolo(phone);
                    grid.appendChild(card);
                });
            } else {
                grid.innerHTML = `<h3>NO DATA FOUND.</h3>`;
            }
        } catch(e) {
            grid.innerHTML = `<h3>SYSTEM ERROR.</h3>`;
        }
    }

    // OPEN MODAL & VISUALIZE DATA
    function openHolo(phone) {
        addToDock(phone);
        
        document.getElementById('m-title').innerText = phone.name;
        document.getElementById('m-desc').innerText = phone.description;
        document.getElementById('m-img').src = phone.thumbnail;
        document.getElementById('btn-dl').href = phone.thumbnail;

        currentTextToSpeak = `${phone.name}. ${phone.description}`;

        // VISUALIZE SPECS (Regex Parsing)
        const ramMatch = phone.description.match(/(\d+)GB RAM/);
        const batMatch = phone.description.match(/(\d+)mAh/);
        
        updateMeter('meter-ram', 'txt-ram', ramMatch ? ramMatch[1] : 0, 16); // Max 16GB
        updateMeter('meter-bat', 'txt-bat', batMatch ? batMatch[1] : 0, 6000); // Max 6000mAh

        modal.classList.add('active');
    }

    function updateMeter(circleId, textId, value, max) {
        const circle = document.getElementById(circleId);
        const text = document.getElementById(textId);
        const circumference = 2 * Math.PI * 35; // r=35
        
        // Calculate percentage
        const valNum = parseInt(value);
        const percent = valNum > 0 ? valNum / max : 0;
        const offset = circumference - (percent * circumference);

        circle.style.strokeDashoffset = offset;
        
        if(circleId.includes('ram')) text.innerText = valNum > 0 ? valNum + "GB" : "N/A";
        else text.innerText = valNum > 0 ? valNum + "mAh" : "N/A";
    }

    function closeModal() {
        modal.classList.remove('active');
        window.speechSynthesis.cancel(); // Stop talking
    }

    // TEXT TO SPEECH
    function speakDetails() {
        window.speechSynthesis.cancel();
        const speech = new SpeechSynthesisUtterance(currentTextToSpeak);
        speech.lang = 'en-US';
        speech.pitch = 0.9;
        speech.rate = 1;
        window.speechSynthesis.speak(speech);
    }

    // DOCK HISTORY LOGIC
    function addToDock(phone) {
        if(historyList.find(p => p.name === phone.name)) return;
        
        historyList.unshift(phone);
        if(historyList.length > 5) historyList.pop();

        dock.style.display = 'flex';
        dockContent.innerHTML = historyList.map(p => `
            <div class="dock-item" onclick="openHoloFromDock('${p.name}')">
                <img src="${p.thumbnail}">
            </div>
        `).join('');
    }

    function openHoloFromDock(name) {
        const phone = historyList.find(p => p.name === name);
        if(phone) openHolo(phone);
    }

</script>
